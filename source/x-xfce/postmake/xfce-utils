# Make the xinitrc:
mkdir -p ${packageDir}/etc/X11/xinit
mv ${packageDir}/etc/xdg/xfce4/xinitrc \
   ${packageDir}/etc/X11/xinit/xinitrc.xfce
chmod 755 ${packageDir}/etc/X11/xinit/xinitrc.xfce
(
  cd ${packageDir}/etc/X11/xinit
  ln -sf xinitrc.xfce xinitrc
)
( cd ${packageDir}/etc/xdg/xfce4
  ln -s /etc/X11/xinit/xinitrc.xfce xinitrc
)

# Add the profile:
mkdir -p ${packageDir}/etc/profile.d
cat ${currentWorkDir}/postmake/files/xfce \
 > ${packageDir}/etc/profile.d/xfce.new
chmod 755 ${packageDir}/etc/profile.d/xfce.new

mkdir -p ${packageDir}/install
cat << "EOF" > ${packageDir}/install/post-install
# Handle config files:
config() {
  local new old
  new="$1"
  old=${1%.new}
  if [ ! -r $old ]; then
    mv $new $old
  elif [ "$(md5sum $old | cut -f 1 -d ' ')" = "$(md5sum $new | cut -f 1 -d ' ')" ]; then
    rm $new
  else
    echo "You have a new config file \"${new}\" at your consideration."
  fi
}

config etc/profile.d/xfce.new

if [ -x /usr/bin/update-desktop-database ]; then
  /usr/bin/update-desktop-database -q /usr/share/applications
fi

if [ -x /usr/bin/gtk-update-icon-cache ]; then
  /usr/bin/gtk-update-icon-cache -qfi /usr/share/icons/hicolor
fi

EOF
