# Functions related with the config file.

# Function: readConfig
# Function to read and export variables in a secure way.
#
readConfig() {
  local IFS='=' variable value array

  while read -r variable value ; do
    case "$variable" in
      \#*|"")	# Ignore commentary or blank lines.
        ;;
      *)
        # Iterate over the cmdLineSets array to see if the options
        # set on the command line are defined in the configuration
        # file, if so, the value of the configuration file is
        # ignored (the command-line has priority)
        if (( ${#cmdLineSets[@]} > 0 )) ; then
          for array in "${cmdLineSets[@]}" ; do
            if [[ $array = $variable ]] ; then
              continue 2;	# Continue from the beginning.
            fi
          done
        fi

        # Evaluate arguments.
        #
        # Export variable escaping its value avoiding code execution
        eval "export "$variable=\$value"" 2> /dev/null
        ;;
    esac
  done
}

# Function: showVar
# A function to print the variable values.
#
# Usage: showVar [variable name ...] file
#
# FIXME: This function is a bit quick and dirty, there are certain
# problems with it, it allows varname="asdf' (mismatched quotes) and
# if you have varname="something\nsomethingelse\n" it will fail to
# print the first something.
#
showVar() {
  for varname in "$@" ; do
    sed -r -n \
     "/^$varname=[\"\'][^\"\']*$/,/[\"\']/{//d;/^$varname=/d;p} ; s/^$varname=\"?'?([^\"\']+)\"?'?$/\1/p" "${@: -1}"
  done
             
  unset varname
}

