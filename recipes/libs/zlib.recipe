# Build recipe for zlib.
#
# Copyright (C) 2015 Matias A. Fonzo, selk@dragora.org.
#
# This recipe is free software: you have unlimited permission
# to copy, distribute and modify it.

program=zlib
version=1.2.8
release=1

tarname=${program}-${version}.tar.gz

description="
zlib - A compression data library.

Zlib is a software library used for data compression, and is an
abstraction of the deflate compression algorithm used in their
gzip file compression program.

Zlib was written by Jean-loup Gailly and Mark Adler.

"

homepage=http://zlib.net
licenses=Custom

# Remote source(s)
fetch=(
  http://zlib.net/$tarname
)

docs=""ChangeLog FAQ README doc/*.txt""
docdir=/usr/share/doc/${program}-${version}

build {
  cd "$srcdir"

  ./configure --prefix=/usr --static

  make -j${jobs}
  make -j${jobs} install DESTDIR="$destdir"

  # Compress and link manual pages (if needed)
  if [[ -d ${destdir}/usr/share/man ]] ; then
    ( cd "${destdir}"/usr/share/man && \
      find . -type f -exec gzip -9 '{}' \; && \
      find . -type l | while read -r file ; do
        ln -sf "$(readlink "$file").gz" "${file}.gz" && \
        rm -- "$file"
      done
    )
  fi

  # Copy the documentation
  mkdir -p "${destdir}${docdir}" && cp -a "$docs" "${destdir}${docdir}"
}

