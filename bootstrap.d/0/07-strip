# Strip binaries and libraries
#
# Copyright (C) 2014 Matias A. Fonzo.
#
# This script is free software: you have unlimited permission
# to copy, distribute and modify it.

# Default directory for stripping
strip_dir="$crossdir"

# To verify option passed in `bootstrap'
if [ "$strip" = "nostrip" ] ; then
  exit 0
fi
# Sanity check
if [ ! -d "$strip_dir" ] ; then
  echo "\`$strip_dir' is not a valid directory. It won't be stripped."
  exit 1
fi

echo "==> Stripping binaries and libraries in \`$strip_dir' (if any) ..."

find "$strip_dir" -type f | xargs file | awk '/ELF/ && (/executable/ || /shared object/ || /relocatable/) && /not stripped/' | \
 cut -f 1 -d : | xargs strip -p --remove-section=.comment --remove-section=.note 2> /dev/null

find "$strip_dir" -type f | xargs file | grep 'current ar archive' | \
 cut -f 1 -d : | xargs strip -p --strip-debug 2> /dev/null

unset strip_dir
keepdir=keepdir;	# Avoid directory detection in `bootstrap'

