# Build script for linux-libre (headers)
#
# Copyright (C) 2014 Matias A. Fonzo.
#
# This script is free software: you have unlimited permission
# to copy, distribute and modify it.

version=3.4.105

echo "Unpacking linux-${version} ..."
rm -rf "${tmpdir}"/linux-${version}
tar xf "${tardir}"/linux-libre-${version}-gnu1.tar.?z* -C "$tmpdir"

# Build instructions
cd "${tmpdir}"/linux-${version}

make mrproper
make headers_check ARCH="$ARCH"
make headers_install ARCH="$ARCH" INSTALL_HDR_PATH=dest

# Copy headers
mkdir -p "${crossdir}"/${TARGET}/include
cp -r dest/include/* "${crossdir}"/${TARGET}/include/

# Remove cruft
find "${crossdir}"/${TARGET}/include \
 -type f \( -name .install -o -name ..install.cmd \) -exec rm -f {} +

