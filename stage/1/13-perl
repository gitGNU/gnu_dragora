# Copyright (C) 2012-2013 Matias A. Fonzo.
#
# This script is free software: you have unlimited permission
# to copy, distribute and modify it.

version=5.18.1

# Uncompression
rm -rf ${TMPDIR}/perl-${version}
tar xf ${SRCDIR}/perl-${version}.tar.?z* -C $TMPDIR

# Build
cd ${TMPDIR}/perl-${version}

patch -Np0 -i ${PATCHDIR}/perl/perl-fnostack-protector
patch -Np0 -i ${PATCHDIR}/perl/perl-linux-static.sh

./Configure -des \
 -Uuseshrplib \
 -Uusedl \
 -Dprefix=/tools \
 -Dprivlib=/tools/lib/perl5 \
 -Dsitelib=/tools/lib/perl5/site_perl \
 -Accflags="-D_GNU_SOURCE -D_BSD_SOURCE -I/tools/include" \
 -A ldflags="-Wl,-static"

make $jobs

cp perl cpan/podlators/pod2man /tools/bin
mkdir -p /tools/lib/perl5 && cp -R lib/* /tools/lib/perl5

