# Copyright (C) 2012 Matias A. Fonzo.
#
# This script is free software: you have unlimited permission
# to copy, distribute and modify it.

version=1.20.2

# Uncompression
rm -rf ${TMPDIR}/busybox
rm -rf ${TMPDIR}/busybox-${version}
tar xf ${SRCDIR}/busybox-${version}.tar.?z* -C $TMPDIR

# Build
cd ${TMPDIR}/busybox-${version} || cd ${TMPDIR}/busybox

make mrproper

# Patch to include lzip support
zcat ${PATCHDIR}/busybox-1.20.2_lzip-1.gz | patch -p1

zcat ${ARCHIVE}/busybox-config_stage1.gz > .config
make oldconfig

make $jobs HOSTCC="gcc -D_GNU_SOURCE" busybox
make HOSTCC="gcc -D_GNU_SOURCE" CONFIG_PREFIX=/tools install

